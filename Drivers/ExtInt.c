/*******************************************************Copyright*********************************************************
**                                            北京博创兴盛机器人技术有限公司
**                                                       研发部
**                                               http://robot.up-tech.com
**
**-------------------------------------------------------文件信息---------------------------------------------------------
** 文件名称:			ExtInt.c
** 最后修订日期:		2009-08-17
** 最后版本:			1.0
** 描述:		    	外部中断的接口函数，控制外部中断的初始化，工作模式。
**
**------------------------------------------------------------------------------------------------------------------------
** 创建人:			律晔
** 创建日期:			2009-08-17
** 版本:				1.0
** 描述:		    	外部中断的接口函数，控制外部中断的初始化，工作模式。
**
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
** 版本:
** 描述:
**
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
** 版本:
** 描述:
**
*************************************************************************************************************************/
#include "Drivers/ExtInt.h"


/*************************************************************************************************************************
** 函数名称:			SetExtIntMode
**
** 函数描述:			设置外部中断触发模式
**
**
** 输入变量:		    uint8 number； 外部中断接口；uint8 mode 触发电平模式
** 返回值:			void;
**
** 使用宏或常量:		ExtInt相关宏，在ExtInt.h中定义。
** 使用全局变量:	    None;
**
** 调用函数:			SetRegBit;
**
** 创建人:			律晔
** 创建日期:			2009-08-17
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
static void SetExtIntMode(uint8 number, uint8 mode)
{
	uint8 temp_number = 0;

	if (number > 3)
	{
		temp_number = number - 4;
		SetRegMask(EXTINT_EICRB, EXTINT_MODE_MASK << (temp_number << 1), mode << (temp_number << 1));
	}
	else
	{
		SetRegMask(EXTINT_EICRA, EXTINT_MODE_MASK << (number << 1), mode << (number << 1));
	}
}


/*************************************************************************************************************************
** 函数名称:			EnableExtIntInterrupt
**
** 函数描述:			使能外部中断
**
**
** 输入变量:		    uint8 number； 外部中断接口；
** 返回值:			void;
**
** 使用宏或常量:		ExtInt相关宏，在ExtInt.h中定义。
** 使用全局变量:	    None;
**
** 调用函数:			SetRegBit;
**
** 创建人:		    律晔
** 创建日期:			2009-08-17
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
static void EnableExtIntInterrupt(uint8 number)
{
	SetRegBit(EXTINT_EIMSK, number);
}


/*************************************************************************************************************************
** 函数名称:			DisableExtIntInterrupt
**
** 函数描述:			使能外部中断
**
**
** 输入变量:		    uint8 number； 外部中断接口；
** 返回值:			void;
**
** 使用宏或常量:		ExtInt相关宏，在ExtInt.h中定义。
** 使用全局变量:	    None;
**
** 调用函数:			SetRegBit;
**
** 创建人:		    律晔
** 创建日期:			2009-08-17
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
static void DisableExtIntInterrupt(uint8 number)
{
	ClrRegBit(EXTINT_EIMSK, number);
}


/*************************************************************************************************************************
** 函数名称:			InitExtInt
**
** 函数描述:			使能外部中断
**
**
** 输入变量:		    void;
** 返回值:			void;
**
** 使用宏或常量:		ExtInt相关宏，在ExtInt.h中定义。
** 使用全局变量:	    None;
**
** 调用函数:			SetRegBit;
**
** 创建人:		    律晔
** 创建日期:			2009-08-17
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
static void InitExtInt(void)
{
	SetReg(extint_control.state , 0x00);								// 初始化状态寄存器

	ClrRegBit(EXTINT_DDR_INT0, EXTINT_DDR_BIT_INT0);
	ClrRegBit(EXTINT_PORT_INT0, EXTINT_PORT_BIT_INT0);

	SetExtIntMode(EXTINT_INT0, EXTINT_MODE_RISING);						// 设置INT0为上升沿中断

	EnableExtIntInterrupt(EXTINT_INT0);									// 使能INT0中断

	extint_control.pSetMode = SetExtIntMode;
	extint_control.pEnableInterrupt = EnableExtIntInterrupt;
	extint_control.pDisableInterrupt = DisableExtIntInterrupt;

	SetRegBit(extint_control.state, INIT_COMPLETE);						// 置位初始化完成标志
}


/*************************************************************************************************************************
                                                       控制结构体声明
*************************************************************************************************************************/
EXTINT_CONTROL_STRUCT extint_control = { .pInit = InitExtInt };


/*************************************************************************************************************************
**                                                      文件结束
*************************************************************************************************************************/
