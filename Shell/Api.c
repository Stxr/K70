/*******************************************************Copyright*********************************************************
**                                            北京博创兴盛机器人技术有限公司
**                                                       研发部
**                                               http://robot.up-tech.com
**
**-------------------------------------------------------文件信息---------------------------------------------------------
** 文件名称:			Api.c
** 最后修订日期:		2009-05-27
** 最后版本:			1.0
** 描述:				Fractal库的应用程序接口，用于与NorthStar流程图编译环境的联调
**
**------------------------------------------------------------------------------------------------------------------------
** 创建人:			律晔
** 创建日期:			2009-05-27
** 版本:				1.0
** 描述:				主要实现对CommandActuator中使用的功能函数进行标准化封装
**
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
** 版本:
** 描述:
**
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
** 版本:
** 描述:
**
*************************************************************************************************************************/
#include "Shell/Api.h"

static uint8 servo_update_count = 0;

/*************************************************************************************************************************
**														外部函数声明
*************************************************************************************************************************/
/*************************************************************************************************************************
** 函数名称:				DelayMS
**
** 函数描述:				毫秒级延时函数，与GCC库函数_delay_ms相关联。
**
**
** 输入变量:				int32 inMS;
** 返回值:				void;
**
** 使用宏或常量:			None;
** 使用全局变量:			None;
**
** 调用函数:				_delay_ms;
**
** 创建人:				律晔
** 创建日期:				2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFInit(void)
{
	InitDevices();
}


/*************************************************************************************************************************
** 函数名称:				DelayMS
**
** 函数描述:				毫秒级延时函数，与GCC库函数_delay_ms相关联。
**                      
**					                 
** 输入变量:				int32 inMS;
** 返回值:				void;
**
** 使用宏或常量:			None;
** 使用全局变量:			None;
**
** 调用函数:				_delay_ms;
**
** 创建人:				律晔
** 创建日期:				2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void DelayMS(int32 inMS)
{
	clock_control.pDelayMs((int16)inMS);
}


/*************************************************************************************************************************
** 函数名称:				MFSetPortDirect
**
** 函数描述:				设置端口方向
**                      
**					                 
** 输入变量:				uint32 inData;
** 返回值:				void;
**
** 使用宏或常量:			None;
** 使用全局变量:			None;
**
** 调用函数:				_delay_ms;
**
** 创建人:				律晔
** 创建日期:				2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFSetPortDirect(uint32 inData)
{
	gpio_control.pSetGpioDdr((uint16)inData);
}


/*************************************************************************************************************************
** 函数名称:			MFGetDigiInput
**
** 函数描述:			 读取IO输入
**                      
**					                 
** 输入变量:			int32 inID;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			gpio_control.pGetInputFilteBit;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
int32 MFGetDigiInput(int32 inID)
{
	uint8 temp_value = 0;
	gpio_control.pGetInputFilteBit((uint8)inID, &temp_value);
	return (int32)temp_value;
}


/*************************************************************************************************************************
** 函数名称:			MFDigiOutput
**
** 函数描述:			设置IO输出
**                      
**					                 
** 输入变量:			int32 inID;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			gpio_control.pSetOutputBit;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFDigiOutput(int32 inID,int32 inVal)
{
	gpio_control.pSetOutputBit((uint8)inID, (uint8)inVal);
}


/*************************************************************************************************************************
** 函数名称:			MFGetAD
**
** 函数描述:			设置IO输出
**                      
**					                 
** 输入变量:			int32 inID;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			adc_control.pGetAdcValue;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
int32 MFGetAD(int32 inID)
{
	uint16 temp_value = 0;
	adc_control.pGetValue((uint8)inID, &temp_value);
	return (int32)temp_value;
}


/*************************************************************************************************************************
** 函数名称:			MFSetServoMode
**
** 函数描述:			舵机模式设置
**                      
**					                 
** 输入变量:			int32 inID; int32 inMode；
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			gpio_control.pSetOutputBit;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFSetServoMode(int32 inID,int32 inMode)
{
	servo_control.pSetMode((uint8)inID, (uint8)inMode);
}


/*************************************************************************************************************************
** 函数名称:			MFSetServoPos
**
** 函数描述:			舵机位置设置
**                      
**					                 
** 输入变量:			int32 inID, int32 inPos, int32 inSpeed;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			gpio_control.pSetOutputBit;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFSetServoPos(int32 inID,int32 inPos,int32 inSpeed)
{
	//servo_control.pSetSyncPosition((uint8)inID, (uint16)inPos, (uint16)inSpeed);
	servo_control.pSetPosition((uint8)inID, (uint16)inPos, (uint16)inSpeed);
	servo_update_count++;
	if (servo_update_count > 16)
	{
		MFServoAction();
		servo_update_count = 0;
		_delay_us(500);
	}
}

/*************************************************************************************************************************
** 函数名称:			MFSetServoRotaSpd
**
** 函数描述:			 舵机电机模式速度设置
**                      
**					                 
** 输入变量:			int32 inID, int32 inPos, int32 inSpeed;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			gpio_control.pSetOutputBit;
**
** 创建人:		    	律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFSetServoRotaSpd(int32 inID,int32 inSpeed)
{
	if(inSpeed >= 0)
	{
		// servo_control.pSetSyncVelocity((uint8)inID, 0x00, (uint16)inSpeed);
		// servo_control.pSetRegVelocity((uint8)inID, 0x00, (uint16)inSpeed);
		servo_control.pSetVelocity((uint8)inID, 0x00, (uint16)inSpeed);
	}
	else
	{
		// servo_control.pSetSyncVelocity((uint8)inID, 0x01, (uint16)(-inSpeed));
		// servo_control.pSetRegVelocity((uint8)inID, 0x01, (uint16)(-inSpeed));
		servo_control.pSetVelocity((uint8)inID, 0x01, (uint16)(-inSpeed));
	}
	
	servo_update_count++;
	if (servo_update_count > 16)
	{
		MFServoAction();
		servo_update_count = 0;
		_delay_us(100);
	}

}

/*************************************************************************************************************************
** 函数名称:			MFGetServoPos
**
** 函数描述:			获取舵机位置
**                      
**					                 
** 输入变量:			int32 inID, int32 inPos, int32 inSpeed;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			gpio_control.pSetOutputBit;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
int32 MFGetServoPos(int32 inID)
{
	uint16 temp_value = 0;

	servo_control.pGetPosition((uint8)inID, &temp_value);
	return (int32)temp_value;
}

/*************************************************************************************************************************
** 函数名称:			MFServoAction
**
** 函数描述:			 运动指令执行
**                      
**					                 
** 输入变量:			void;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			servo_control.pActionServo;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFServoAction()
{
	// servo_control.pAction();
	servo_control.pActionSync();
	servo_update_count = 0;
}


/*************************************************************************************************************************
** 函数名称:			MFInitServoMapping
**
** 函数描述:			 运动指令执行
**
**
** 输入变量:			void;
** 返回值:			void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			servo_control.pActionServo;
**
** 创建人:			律晔
** 创建日期:			2009-05-31
**------------------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************/
void MFInitServoMapping(uint8* p_mapping, uint8 amount)
{
	servo_control.pInitNodeBuffer(p_mapping, amount);
}
//以下是小螃蟹个人写的函数
void Uart0SetDCB(uint8 mode, uint32 baud){
	uart0_test.pSetBaudRate(mode,baud);
}
void Uart0Send(uint8 val){
	uart0_test.pWriteTxBuffer(val);
	uart0_test.pSendTxBuffer();
}
void Uart1SetDCB(uint8 mode, uint32 baud){
	uart1_test.pSetBaudRate(mode,baud);
}
void Uart1Send(uint8 val){
	uart1_test.pWriteTxBuffer(val);
	uart1_test.pSendTxBuffer();
}
/*************************************************************************************************************************
**                                                      文件结束
*************************************************************************************************************************/
